{% extends "base.html" %}
{% block title %}ƒåasovaƒç ‚Äì {{ mode|capitalize }}{% endblock %}
{% block content %}
<style>
  .timer-container {
    max-width: 420px;
    margin: 32px auto;
    background: rgba(17, 24, 39, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 18px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.3);
    padding: 32px 24px 24px 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 18px;
  }
  .timer-inputs {
    display: flex;
    gap: 18px;
    width: 100%;
    justify-content: center;
  }
  .timer-inputs label {
    font-weight: 500;
    margin-bottom: 4px;
    display: block;
    color: var(--text);
  }
  .timer-inputs input {
    width: 60px;
    padding: 6px;
    border-radius: 6px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.1);
    color: var(--text);
    text-align: center;
    font-size: 1.1em;
  }
  .timer-buttons {
    display: flex;
    gap: 16px;
    margin-top: 8px;
    flex-wrap: wrap;
  }
  .timer-display {
    font-size: 64px;
    font-weight: 900;
    margin-top: 18px;
    letter-spacing: 2px;
    transition: color 0.3s;
    color: var(--acc);
  }
  .phase-work { color: #2ecc40; }
  .phase-rest { color: #ff4136; }

  .btn-green {
    background: #2ecc40 !important;
    color: #fff !important;
    border: none;
    box-shadow: 0 2px 8px rgba(46,204,64,0.12);
    transition: background 0.2s;
  }
  .btn-green:hover {
    background: #27ae38 !important;
  }
  .btn-red {
    background: #ff4136 !important;
    color: #fff !important;
    border: none;
    box-shadow: 0 2px 8px rgba(255,65,54,0.12);
    transition: background 0.2s;
  }
  .btn-red:hover {
    background: #e12d1c !important;
  }

  .timer-rounds {
    font-size: 1.1em;
    color: var(--muted);
    font-weight: 600;
  }

  /* Mobiln√≠ rozvr≈æen√≠ */
  @media (max-width: 600px) {
    .timer-container {
      max-width: 98vw;
      padding: 16px 4vw 16px 4vw;
      gap: 12px;
    }
    .timer-inputs {
      flex-direction: column;
      gap: 10px;
      align-items: stretch;
    }
    .timer-buttons {
      flex-direction: column;
      gap: 10px;
      align-items: stretch;
    }
    .timer-display {
      font-size: 44px;
      margin-top: 10px;
    }
    .timer-rounds {
      font-size: 1em;
    }
  }
  /* Desktop rozvr≈æen√≠ */
  @media (min-width: 601px) {
    .timer-container {
      max-width: 420px;
      padding: 32px 24px 24px 24px;
      gap: 18px;
    }
    .timer-inputs {
      flex-direction: row;
      gap: 18px;
      align-items: center;
    }
    .timer-buttons {
      flex-direction: row;
      gap: 16px;
      align-items: center;
    }
    .timer-display {
      font-size: 64px;
      margin-top: 18px;
    }
    .timer-rounds {
      font-size: 1.1em;
    }
  }
</style>

<div class="timer-container">
  <h1 style="margin-bottom:0; color: var(--text);">‚è±Ô∏è ƒåasovaƒç ({{ mode|capitalize }})</h1>
  <p class="muted" style="margin-top:2px">Modern√≠ odpoƒçet pro s√©rie/cviky.</p>
  
  <div class="timer-inputs">
    <div>
      <label for="work">Pr√°ce (s)</label>
      <input id="work" type="number" value="30" min="1" max="600">
    </div>
    <div>
      <label for="rest">Pauza (s)</label>
      <input id="rest" type="number" value="15" min="1" max="600">
    </div>
    <div>
      <label for="rounds">Kola</label>
      <input id="rounds" type="number" value="8" min="1" max="99">
    </div>
  </div>
  
  <div class="timer-buttons">
    <button class="btn btn-green" id="start" style="font-size:1.2em;padding:10px 28px">‚ñ∂Ô∏è Start</button>
    <button class="btn btn-red" id="pause" style="font-size:1.2em;padding:10px 28px">‚è∏Ô∏è Pause</button>
    <button class="btn secondary" id="reset" style="font-size:1.2em;padding:10px 28px">üîÑ Reset</button>
  </div>
  
  <div class="timer-rounds" id="roundsDisplay">Kolo: 1 / 8</div>
  <div class="timer-display phase-work" id="display">00:30</div>
</div>

<script>
  const mode = '{{ mode }}';
  const disp = document.getElementById('display');
  const work = document.getElementById('work');
  const rest = document.getElementById('rest');
  const rounds = document.getElementById('rounds');
  const start = document.getElementById('start');
  const reset = document.getElementById('reset');
  const roundsDisplay = document.getElementById('roundsDisplay');
  const pause = document.getElementById('pause');

  let timer=null, remaining=0, phase='work', leftRounds=0, totalRounds=0, currentRound=1;

  function fmt(s){ 
    s=Math.max(0, s|0); 
    const m=(s/60)|0, r=(s%60)|0; 
    return `${m.toString().padStart(2,'0')}:${r.toString().padStart(2,'0')}`; 
  }

  function updateDisplay(){
    disp.textContent = fmt(remaining);
    disp.className = 'timer-display phase-' + phase;
    roundsDisplay.textContent = `Kolo: ${currentRound} / ${totalRounds}`;
  }

  function tick(){
    remaining--;
    updateDisplay();
    if (remaining<=0){
      if (phase==='work') {
        phase='rest';
        remaining=+rest.value||0;
        updateDisplay();
      } else {
        phase='work';
        leftRounds--;
        currentRound++;
        if (leftRounds<=0){
          clearInterval(timer); 
          timer=null;
          disp.textContent = 'üéâ Hotovo!';
          disp.className = 'timer-display';
          roundsDisplay.textContent = `Kolo: ${totalRounds} / ${totalRounds}`;
          return;
        }
        remaining=+work.value||0;
        updateDisplay();
      }
    }
  }

  let paused = false;
  
  start.onclick = () => {
    if (timer) return;
    if (paused) {
      timer = setInterval(tick, 1000);
      paused = false;
      return;
    }
    totalRounds = +rounds.value || 1;
    leftRounds = totalRounds;
    currentRound = 1;
    remaining = +work.value || 30;
    phase='work';
    updateDisplay();
    timer = setInterval(tick, 1000);
  };
  
  pause.onclick = () => {
    if (timer) { 
      clearInterval(timer); 
      timer = null; 
      paused = true; 
    }
  };
  
  reset.onclick = () => {
    if (timer) clearInterval(timer);
    timer=null;
    paused = false;
    totalRounds = +rounds.value || 1;
    leftRounds = totalRounds;
    currentRound = 1;
    phase='work';
    remaining = +work.value || 30;
    updateDisplay();
  };
  
  // Inicializace
  reset.onclick();
</script>
{% endblock %}
